Тестовое задание в компанию MEDODS.

Описание:

1)Структура проекта:

В проекте находятся следующие папки: cmd, config, elements, handlers, pkg.

cmd - содержит исполняемый файл main.go.

config - содержит config.yml с данными для работы программы.

elements - содержит элемент сервер.

handlers - содержит файл с путями по которым будут идти запросы :/get_token для получения токенов и /refresh_token для их обновления.

в pkg находятся следующие папки repository,service,tests,tokens.

В repisitory хранятся скрипты отвечающие за взаимодействие с БД.

В service вызываются промежуточные функции и функции взаимодействия с БД.

в tests лежат тесты

в tokens функции по работе с токенами.

Логика приложения следующая: запрос -> handler -> service -> repository.

2)Структура БД:

В БД 2 таблицы users и refresh_tokens.<br/>
В users хранится id, guid, email.<br/>
В refresh_tokens храниться user_id, refresh_token,available,create_at.<br/>
Связаны таблицы по id -> user_id.<br/>

Краткое описание работы программы:
Токены связаны по uuid который генерируется в процессе создания токенов.
Во время refresh token помимо проверки на валидность токена идёт сравнение token_guid из access_token и refresh_token (для того чтобы понимать что токены, были выпущены вместе).
Также во время refresh token мы смотрим в БД доступен ли данный refresh_token (На случай если надо будет отозвать токены).
Если пользователь отправил разные ip, то в ответе json в поле email вернётся почта пользователя (На которую надо будет отправить warning)

!!Как работать с программой
В БД находитсья пользователь с guid: b758e00b-9c42-4f2b-a84d-0af47b937d17. Поэтому для успешного запроса должно использоваться это guid
При запросе надо передаваться ip пользователя

Формат запроса на /get_token

{
    "guid":"b758e00b-9c42-4f2b-a84d-0af47b937d17",
    "ip":"1.2.3"
}

Формат запроса на /refresh_token

{
    "access_token":"",
    "refresh_token":"",
    "ip":"1.2.4"
}

Docker:

Чтобы использовать docker нужно прописать docker-compose up находясь в папке medods. !!!Так как docker не видит postgre на localhost необходимо в config.yml который лежит в папке config
Поменять db host на postgres (надо раскомментить строку, и закоментить с localhost). По умолчание в config подключение к ДБ идет по localhost.

Tests:

Тесты лежат в паке tests. в неё два файла в all_test.go запускаются тесты, в test_table.go лежать сами тесты.
